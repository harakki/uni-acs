# Отчет по лабораторной работе 5

### Шипилов Дементий, ИП-215

## Кластер Kubernetes

Начальная настройка кластера *K8s* на основе *Minicube* с установкой необходимых для работы плагинов осуществляется командами:

```shell 
# Запуск кластера k8s с Minikube, используя менеджер контейнеров Docker
minikube start --driver docker

# Активация плагинов панели управления
minikube addons enable dashboard
minikube addons enable metrics-server

# Активация плагина маршрутизации трафика извне сервисам в кластере
minikube addons enable ingress
```

Для запуска сетевого приложения (сервиса) нужно выполнить команды

```shell
# Развертывание дейплоймента, который будет управлять подом
kubectl create deployment ${название_деплоймента} --image ${образ_контейнера}

# Объявление сервиса доступным извне для внутреннего тестирования
kubectl expose deployment ${название_деплоймента} --type NodePort --port ${порт_контейнера}

# Туннелирование сервиса на хост
minikube service ${название_сервиса} --url
```

Также запускать сервисы можно и с помощью применения файлов конфигурации с форматом *yaml*.

```shell
# Применение конфигурационного файла
kubectl apply -f путь/к/файлу

# Создание туннеля между хостом и кластером для взаимодействия с сервисами
minikube tunnel
```

> **Под** - группа из одного или более контейнеров, связанных друг с другом для удобного администрирования и организации сети. Все контейрнеры в поде делят один IP-адрес и доступны на собственном порте.
> 
> **Deployment** - сущность, которая проверяет здоровье пода и перезагружает контейнер пода в случае, если он прекратил работу.
>
> **Service** - абстрактный объект, который определяет логический набор подов и политику доступа к ним. Имеет типы:
> 
>   - `ClusterIP` - метод по умолчанию, предоставляет доступ к сервису внутри кластера по локальному IP-адресу;
>
>   - `LoadBalancer` - метод, который предоставляет доступ к сервису извне с помощью внешнего распределителя нагрузки;
>
>   - `NodePort` - метод, который предоставляет доступ к сервису по IP-адресу узла на статическом порте.
>
> **Ingress** - абстрактный объект, который создает HTTP и HTTPS маршруты из-за пределов кластера к сервисам внутри него.

## Helm

Для развертывания релизов сервисов на кластерах *Kubernetes* используется пакетный менеджер *helm*, использующий *helm-чарты* (готовые настраиваемые конфигурации сервисов), которыми можно управлять, используя команды:

```shell
# Вывод списка установленных чартов
helm list

# Вывод краткой информации о релизе
helm status ${название_релиза}

# Вывод полной информации (ресурсов) о релизе
helm get all ${название_релиза}

# Вывод истории изменений релиза
helm history ${название_релиза}

# Генерация нового helm-чарта из стандартного шаблона
helm create ${название_чарта}

# Установка helm-чарта на кластер
helm install ${название_релиза} путь/к/чарту

# Обновление релиза с использованием helm-чарта
helm upgrade ${название_релиза} путь/к/чарту

# Удаление развернутого пакета (чарта) с кластера
helm uninstall ${название_релиза}
```

> Helm хранит информацию о релизах в пространстве имен `kube-system` в виде *ConfigMaps* или *Secrets*.

## Helmfile

Утилита *helmfile* предназначена для удобного развертывания нескольких релизов в различных окружениях на кластере *Kubernetes*. Для работы с ней необходимо создать `helmfile.yaml` с описанием релизов и его применить, используя команду `helmfile apply`.

Пример helmfile'a:

```yaml
environments:
  developement:
    values:
      - values/dev-values.yaml
    releases:
      - name: dev-app
        chart: ./charts/app/beta
        values:
          - values/dev-specific-values.yaml
  production:
    values:
      - values/prod-values.yaml
    releases:
      - name: prod-app
        chart: ./charts/app/release
        values:
          - values/prod-specific-values.yaml
```
