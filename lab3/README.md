# ACS3

Базовая часть *Ansible* и управления конфигурацией.

## Задание

- Создать пару виртуальных машин/контейнеров в которых установлены:

  - OpenSSH, с настроенным доступом по ключу/паролю;

  - Python 3;

  - Pip.

- Инициализировать среду для *Ansible* на “управляющей” системе:

  - Создать структуру каталогов *{inventory, playbooks, roles}*;

  - Создать конфигурацию *ansible.cfg* для работы с созданными каталогами. Необходимо указать расположение и назначение директорий, например `roles_path = roles`;

  - Для созданных виртуальных машин/контейнеров сформировать *inventory*;

  - Сконфигурировать параметры подключения к системам: имя пользователя - *ansible_user*, путь до приватного ключа - *ansible_ssh_private_key_file*;

  - Проверить доступность хостов - `ansible -m ping all` или отдельного хоста `ansible -m ping ${host1?}`.

- Чтобы посмотреть информацию, собираемую *Ansible* о хостах при подключении *(gather facts)*, можно использовать команду `ansible -m setup ${host?}`, где *host* - имя хоста в *inventory*. Результатом выполнения команды является json-файл с информацией о системе. Необходимо получить отдельные поля этого файла и сгенерировать свой файл;

- Для выполнения *Ansible*'ом команд Docker'а, пользователь должен состоять в группе *docker*, или иметь беспарольный доступ к sudo (для повышения привелегий в Ansible используется параметр `become: true`).

### DoD на 3

- Наличие *ansible.cfg*;

- Наличие директории *inventory*, содержащей информацию о подключении к хостам;

- Продемонстрировать выполнение *ad-hoc* команды `ansible -m ping ${host1?},${host2?}`, где *host#* - имя хоста в *inventory*;

- Продемонстрировать выполнение *ad-hoc* команды `ansible -m shell -a hostname ${host1?}`, где *host#* - имя хоста в *inventory*.

    > Вместо *hostname* допускается выполнять другие команды.

### DoD на 4

- DoD на 3;

- Написать *playbook*, который сформирует структурированный файл (yaml, json), содержащий информацию о системе (для примера можно использовать список параметров из задания 1);

- Использовать модуль `ansible.builtin.template` (отдельно создать .j2 шаблон);

- Разместить *playbook* в директории *playbooks*. Шаблон разместить в *playbooks/templates*;

    > Шаблоны пишутся под *jinja2*

- Продемонстрировать результат выполнения *playbook* на хостах из *inventory*. Результат (файл с информацией о системе) может размещаться как на управляющей системе, так и на удаленной.

### DoD на 5

- DoD на 4;

- Директория *roles*, содержащая код отдельных ролей *Ansible*;

- Создать роль для выполнения сценария (например, генерация файла docker-compose и запуск контейнеров через модуль *docker_compose_v2*);

   > Создать стандартные файлы роли можно командой `ansible-galaxy role init ${rolename?}`.

- Вызвать из *playbook* созданную роль, продемонстрировать результат работы.
